<%= current_user.username %>
<%# <%= cl_image_tag(current_user.profile_image.key, width: 100) %>
<h2>My programmes</h2>
<%@programmes.each do |programme|%>
  <div class='programme-card block border card'>
  <h4><%= programme.name %></h4>
  <p><%= programme.splits_per_week %> workouts per week for <%= programme.weeks %> weeks</p>
  <p><%= programme.splits.map(&:category).join(', ') %></p>
  <% total_workouts = programme.splits_per_week * programme.weeks %>
  <div id="progressbar" data-controller="progress"></div>
  <p><%= programme.workouts.count %> done, <%= total_workouts - programme.workouts.count %> to go</p>
  </div>
<% end %>

<<<<<<< Updated upstream
<h2>My progress</h2>
<% @exercises.each do |exercise| %>
  <div class='exercise-card block border card'>
    <h4><%= exercise.name %></h4>
    <ul>
    <% exercise.logs.each do |log| %>
      <li><%= log.workout.date %>: 1RM - <%= log.weight * (36 / (37 - log.repetitions)) %> </li>
=======



<%# <h2 class="account-title">My Account</h2> %>

<div class="account-header">

  <div class="account-avatar">
    <% if current_user.profile_image.attached? %>
    <%= cl_image_tag(current_user.profile_image.key) %>
    <% else %>
      <i class="fa-solid fa-user"></i>
    <% end %>
  </div>

<div class="acc-header-info">
  <h6> <%= current_user.username %> </h6>
  <p> <%= current_user.weight %>kg â€¢ <%= current_user.height %>cm</p>
  <p style="margin-bottom:0px;"><%= current_user.email %></p>
</div>

</div>










<h2 class="section-title">My Programmes</h2>

<% if current_user.programmes.empty? %>
  <p class="d-flex justify-content-center text-center">Create a programme  <br>to get started...</p>
<% else %>

<div class="programmes-container">
  <% @programmes.each do |programme| %>
    <%= link_to programme_workouts_path(programme) do  %>
      <div class='programme-card'>
        <h4 class="programme-name"><%= programme.name %></h4>
        <p><%= programme.splits_per_week %> workouts per week for <%= programme.weeks %> weeks</p>
        <p class="categories"><%= programme.splits.map(&:category).join(' - ') %></p>
        <% total_workouts = programme.splits_per_week * programme.weeks %>
        <% completion_rate = ((programme.workouts.count.to_f / total_workouts)*100).round(2) %>
        <% if completion_rate > 100 %>
          <% completion_rate = 100 %>
        <% end %>
        <% unless completion_rate.zero? %>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: <%= completion_rate %>%;" aria-valuenow="<%= completion_rate %>" aria-valuemin="0" aria-valuemax="100">
              <%= completion_rate %>% Completed
            </div>
          </div>
          <% end %>
        </div>
>>>>>>> Stashed changes
    <% end %>
  </div>
<% end %>
<<<<<<< Updated upstream
=======



  <div class="calendar-container">
  <h2 class="section-title">My Workouts</h2>
  <%= month_calendar(events: @workouts) do |date, workouts| %>
    <%= date %>
    <% workouts.each do |workout| %>
      <div>
        <% if workout.done %>
          <p class="text-center mt-1">âœ…</p>
        <% else %>
          <p class="text-center mt-1"> ðŸ“†</p>
        <% end %>
        <p class="text-center"><%= workout.split.category%><p>
      </div>
    <% end %>
  <% end %>
  </div>





  <h2 class="section-title">My Progress</h2>

  <% if @exercises.empty? %>
    <p class="d-flex justify-content-center text-center">Your progress will show here <br>when you log some workouts...</p>
  <% else %>
    <div id="carouselIndicators" class="carousel slide" data-bs-ride="carousel">
      <!-- Carousel Inner -->
      <div class="carousel-inner">
        <% @exercises.each_with_index do |exercise, index| %>
          <div class="carousel-item <%= 'active' if index == 0 %>">
            <div class="exercise-card chart-card">
                <% logs = exercise.logs.sort_by { |log| log.workout.date }.reverse %>
                <% log_history = {} %>
                <% logs.each do |log| %>
                  <% one_rep_max = log.weight * (1 + (log.repetitions / 30.0)) %>
                  <% date = log.workout.date.strftime('%Y-%m-%d') %>
                  <% if log_history[date].nil? || log_history[date] < one_rep_max %>
                    <% log_history[date] = one_rep_max.round(1) %>
                  <% end %>
                <% end %>
              <!-- Display Chart -->
              <%= line_chart log_history, xtitle: "Date", ytitle: "1 Rep Max(kg)", label: "1RM", title: exercise.name, empty: "No data for now. Lift and log your lift in Lift Logix. We will show your progress here" %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Carousel Controls -->
      <button class="carousel-control-prev" data-bs-target="#carouselIndicators" role="button" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </button>
      <button class="carousel-control-next" data-bs-target="#carouselIndicators" role="button" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </button>
    </div>
  <% end %>



<div class="logout-btn-container">
  <%= link_to 'Log out', destroy_user_session_path, method: :delete, data: { turbo_method: :delete, confirm: 'Are you sure you want to log out?' }, class: 'logout-btn' %>
</div>
>>>>>>> Stashed changes
